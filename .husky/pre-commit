#!/bin/bash
# Auto-update dates in markdown files

set -e

# Get today's date
today=$(date +%Y-%m-%d)

# Get staged .md files
changed_md_files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$' || true)

if [ -z "$changed_md_files" ]; then
  exit 0
fi

echo "ðŸ“… Updating dates in markdown files..."

for file in $changed_md_files; do
  if [ ! -f "$file" ]; then
    continue
  fi
  
  updated=false
  
  # Update frontmatter 'updated:' field
  if grep -q "^updated:" "$file"; then
    sed -i "s/^updated: .*/updated: $today/" "$file"
    updated=true
  fi
  
  # Update body '**Last Updated**: YYYY-MM-DD'
  if grep -q "^\*\*Last Updated\*\*: [0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}$" "$file"; then
    sed -i "s/^\*\*Last Updated\*\*: [0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}$/**Last Updated**: $today/" "$file"
    updated=true
  fi
  
  # Re-stage if updated
  if [ "$updated" = true ]; then
    git add "$file"
    echo "  âœ“ $file"
  fi
done

exit 0
